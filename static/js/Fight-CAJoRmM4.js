import{a as I}from"./axios-CAVU9O-b.js";import{_ as N,r as F,B as J,t as B,g as _,A as W,w as g,b as d,a as s,d as o,c as v,D as O,F as R,G as S,i as p,f as b,p as A,h as H,Q as $,m as j,o as Q,M}from"./index-BFlqL8nd.js";import{a as P}from"./roleApi-MAHECzO9.js";const L={toRole:t=>I("postjson","/fightToRole",t),toMonster:t=>I("postjson","/fightToMonster",t),toBoss:t=>I("postjson","/fightToBoss",t),toImitMonster:t=>I("postjson","/fightToImitMonster",t),toImitBoss:t=>I("postjson","/fightToImitBoss",t)},D={name:"FightModal",props:{modalVisible:{default:!1,type:Boolean},fightLog:{default:[],type:Array},spoils:{default:[],type:Array}},emits:["submit"],setup(t,e){const u=F({}),i=()=>{e.emit("submit")},k=J(()=>{let f=0,h=0;return t.fightLog.map((l,n)=>{let c={},m={};return n%2===0?(c=JSON.parse(JSON.stringify(l.myAttr)),m=JSON.parse(JSON.stringify(l.enemyAttr))):(c=JSON.parse(JSON.stringify(l.enemyAttr)),m=JSON.parse(JSON.stringify(l.myAttr))),f=c.hp/c.oriHp*100,h=m.hp/m.oriHp*100,{...l,aggressor:{...c,hpPercent:f>0?f.toFixed(2):"0"},victim:{...m,hpPercent:h>0?h.toFixed(2):"0"}}})});return{...B(t),...B(u),submit:i,fightLogRender:k}}},U=t=>(A("data-v-181e9dd4"),t=t(),H(),t),z=U(()=>s("span",null,"战利品：",-1)),E={key:0},G={style:{"margin-right":"5px"}},q=p(" ok "),K={class:"LogContent"},X={class:"logs"},Y={class:"logsItem"},Z={class:"sub"},x={class:"oriHp"},tt={class:"detail"},ot={class:"obj"},st={class:"oriHp"};function nt(t,e,u,i,k,f){const h=b("a-button"),l=b("a-modal");return _(),W(l,{open:u.modalVisible,"onUpdate:open":e[0]||(e[0]=n=>u.modalVisible=n),title:t.$t("battleLog"),width:"1024px"},{footer:g(()=>[d(h,{type:"primary",onClick:i.submit,onCancel:i.submit},{default:g(()=>[q]),_:1},8,["onClick","onCancel"])]),default:g(()=>[s("p",null,"结果："+o(u.fightLog[u.fightLog.length-1].sub)+" 胜",1),z,u.spoils.length===0?(_(),v("span",E,"无")):(_(!0),v(R,{key:1},O(u.spoils,n=>(_(),v("span",G,o(n.name),1))),256)),s("div",K,[(_(!0),v(R,null,O(i.fightLogRender,(n,c)=>(_(),v("div",X,[s("p",null,o(t.$t("round"))+" "+o(c+1),1),s("div",Y,[s("div",Z,[s("span",null,o(n.sub),1),s("span",x,[s("span",{class:"hp",style:S(`width: ${n.aggressor.hpPercent}px`)},null,4)]),s("span",null,o(n.aggressor.hpPercent)+"%",1),s("span",null," hp: "+o(n.aggressor.hp)+"/"+o(n.aggressor.oriHp),1),s("span",null,"waigong: "+o(n.aggressor.waigong),1),s("span",null,"neigong: "+o(n.aggressor.neigong),1),s("span",null,"waifang: "+o(n.aggressor.waifang),1),s("span",null,"neifang: "+o(n.aggressor.neifang),1),s("span",null,"huixin: "+o(n.aggressor.huixin),1),s("span",null,"huishang: "+o(n.aggressor.huishang),1),s("span",null,"renxing: "+o(n.aggressor.renxing),1)]),s("div",tt,o(n.aggressor.nickname)+" 对 "+o(n.victim.nickname)+" 造成了 "+o(n.damage)+"点 "+o(n.crit?"暴击伤害":"伤害"),1),s("div",ot,[s("span",null,o(n.obj),1),s("span",st,[s("span",{class:"hp",style:S(`width: ${n.victim.hpPercent}px`)},null,4)]),s("span",null,o(n.victim.hpPercent),1),s("span",null," hp: "+o(n.victim.hp)+"/"+o(n.victim.oriHp),1),s("span",null,"waigong: "+o(n.victim.waigong),1),s("span",null,"neigong: "+o(n.victim.neigong),1),s("span",null,"waifang: "+o(n.victim.waifang),1),s("span",null,"neifang: "+o(n.victim.neifang),1),s("span",null,"huixin: "+o(n.victim.huixin),1),s("span",null,"huishang: "+o(n.victim.huishang),1),s("span",null,"renxing: "+o(n.victim.renxing),1)])])]))),256))])]),_:1},8,["open","title"])}const et=N(D,[["render",nt],["__scopeId","data-v-181e9dd4"]]),it={fight:{toRolePoint:"1",toMonster:"1",toBoss:"2"}},at={name:"Fight",components:{FightModal:et,QuestionCircleOutlined:$},setup(){const{t}=j(),e=F({uid:sessionStorage.getItem("uid"),missionPoint:"",enemyName:"",enemyId:"",roleOptionsList:[],fightLog:[],spoils:[],currentMonsterWinRate:"0%",currentBossWinRate:"0%",modalVisible:!1});Q(async()=>{await u(),await l(),await n()});const u=async()=>{let a=await P.getRoleList({});e.roleOptionsList=a.data.filter(r=>r.uid!==e.uid).map(r=>({label:r.nickname,value:r.uid})),e.missionPoint=a.data.find(r=>r.uid===e.uid).missionpoint},i=async()=>{let a=await P.getInfo({uid:e.uid});e.missionPoint=a.data.baseInfo.missionpoint},k=async()=>{M.confirm({title:`${t("attackRoleTips")}：${e.enemyName}?`,content:d("div",{style:"color:red;"}),okText:t("attack"),cancelText:t("cancel"),async onOk(){let a=await L.toRole({uid:e.uid,enemyId:String(e.enemyId)});e.fightLog=a.data.fightLog,e.modalVisible=!0,await i()}})},f=async()=>{M.confirm({title:`${t("attackMonsterTips")}：${t("toMonster")}?`,content:d("div",{style:"color:red;"}),async onOk(){let a=await L.toMonster({uid:e.uid});e.fightLog=a.data.fightLog,e.spoils=a.data.spoils,e.modalVisible=!0,await i()}})},h=async()=>{M.confirm({title:`${t("attackMonsterTips")}：${t("toBoss")}?`,content:d("div",{style:"color:red;"}),async onOk(){let a=await L.toBoss({uid:e.uid});e.fightLog=a.data.fightLog,e.spoils=a.data.spoils,e.modalVisible=!0,await i()}})},l=async()=>{let a=await L.toImitMonster({uid:e.uid}),r=0,C=JSON.parse(sessionStorage.getItem("userInfo")).nickname;for(let y=0;y<a.data.fightLogs.length;y++)a.data.fightLogs[y].sub===C&&r++;e.currentMonsterWinRate=r+"%"},n=async()=>{let a=await L.toImitBoss({uid:e.uid}),r=0,C=JSON.parse(sessionStorage.getItem("userInfo")).nickname;for(let y=0;y<a.data.fightLogs.length;y++)a.data.fightLogs[y].sub===C&&r++;e.currentBossWinRate=r+"%"},c=(a,r)=>{e.enemyName=e.roleOptionsList.find(C=>C.label===r.label).label},m=()=>{},w=()=>{},V=(a,r)=>r.value.toLowerCase().indexOf(a.toLowerCase())>=0,T=()=>{e.modalVisible=!1};return{...B(e),baseConfig:it,filterOption:V,handleChange:c,handleBlur:m,handleFocus:w,QuestionCircleOutlined:$,toRole:k,toMonster:f,toImitMonster:l,toImitBoss:n,toBoss:h,modalClose:T}}},lt={class:"fight"},rt={class:"missionPoint"},dt={class:"toRole"},ct={class:"toMonster"},gt={class:"toBoss"};function ut(t,e,u,i,k,f){const h=b("a-select"),l=b("a-button"),n=b("QuestionCircleOutlined"),c=b("a-tooltip"),m=b("FightModal");return _(),v(R,null,[s("div",lt,[s("p",rt,o(t.$t("missionPoint"))+"："+o(t.missionPoint),1),s("div",dt,[s("p",null,o(t.$t("toRole")),1),s("p",null,o(t.$t("useMissionPoint"))+"："+o(i.baseConfig.fight.toRolePoint),1),d(h,{value:t.enemyId,"onUpdate:value":e[0]||(e[0]=w=>t.enemyId=w),"show-search":"",placeholder:"Select a person",options:t.roleOptionsList,"filter-option":i.filterOption,onFocus:i.handleFocus,onBlur:i.handleBlur,onChange:i.handleChange},null,8,["value","options","filter-option","onFocus","onBlur","onChange"]),d(l,{type:"primary",onClick:i.toRole,disabled:!t.enemyId},{default:g(()=>[p(o(t.$t("attack")),1)]),_:1},8,["onClick","disabled"])]),s("div",ct,[s("p",null,o(t.$t("toMonster")),1),s("p",null,o(t.$t("useMissionPoint"))+"："+o(i.baseConfig.fight.toMonster),1),d(l,{type:"primary",onClick:i.toMonster},{default:g(()=>[p(o(t.$t("attack")),1)]),_:1},8,["onClick"]),d(l,{type:"primary",onClick:i.toImitMonster},{default:g(()=>[p(o(t.$t("imitAttack")),1)]),_:1},8,["onClick"]),s("div",null,[p(o(t.$t("currentWinRate"))+" "+o(t.currentMonsterWinRate)+" ",1),d(c,null,{title:g(()=>[p(o(t.$t("monsterTips")),1)]),default:g(()=>[d(n,{style:{color:"#d2d2d2"}})]),_:1})])]),s("div",gt,[s("p",null,o(t.$t("toBoss")),1),s("p",null,o(t.$t("useMissionPoint"))+"："+o(i.baseConfig.fight.toBoss),1),d(l,{type:"primary",onClick:i.toBoss},{default:g(()=>[p(o(t.$t("attack")),1)]),_:1},8,["onClick"]),d(l,{type:"primary",onClick:i.toImitBoss},{default:g(()=>[p(o(t.$t("imitAttack")),1)]),_:1},8,["onClick"]),s("div",null,[p(o(t.$t("currentWinRate"))+" "+o(t.currentBossWinRate)+" ",1),d(c,null,{title:g(()=>[p(o(t.$t("bossTips")),1)]),default:g(()=>[d(n,{style:{color:"#d2d2d2"}})]),_:1})])])]),d(m,{modalVisible:t.modalVisible,fightLog:t.fightLog,spoils:t.spoils,onSubmit:i.modalClose},null,8,["modalVisible","fightLog","spoils","onSubmit"])],64)}const ft=N(at,[["render",ut],["__scopeId","data-v-b0df3350"]]);export{ft as default};
//# sourceMappingURL=Fight-CAJoRmM4.js.map
