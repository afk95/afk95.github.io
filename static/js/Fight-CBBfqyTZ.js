import{a as _}from"./axios-DJuMnALa.js";import{_ as N,r as T,B as V,t as L,g as $,A,w as d,b as a,a as s,d as o,c as k,D as R,F as B,G as O,i as c,f as b,p as J,h as H,Q as S,m as j,o as Q,M as I}from"./index-PFhGpLVs.js";import{a as P}from"./roleApi-BsdKlQpp.js";const w={toRole:t=>_("postjson","/fightToRole",t),toMonster:t=>_("postjson","/fightToMonster",t),toBoss:t=>_("postjson","/fightToBoss",t),toImitMonster:t=>_("postjson","/fightToImitMonster",t),toImitBoss:t=>_("postjson","/fightToImitBoss",t)},D={name:"FightModal",props:{modalVisible:{default:!1,type:Boolean},fightLog:{default:[],type:Array},spoils:{default:[],type:Array}},emits:["submit"],setup(t,e){const p=T({}),i=()=>{e.emit("submit")},M=V(()=>{let h=0,m=0;return t.fightLog.map((l,n)=>{let u={},f={};return n%2===0?(u=JSON.parse(JSON.stringify(l.myAttr)),f=JSON.parse(JSON.stringify(l.enemyAttr))):(u=JSON.parse(JSON.stringify(l.enemyAttr)),f=JSON.parse(JSON.stringify(l.myAttr))),h=u.hp/u.oriHp*100,m=f.hp/f.oriHp*100,{...l,aggressor:{...u,hpPercent:h>0?h.toFixed(2):"0"},victim:{...f,hpPercent:m>0?m.toFixed(2):"0"}}})});return{...L(t),...L(p),submit:i,fightLogRender:M}}},U=t=>(J("data-v-0b156f34"),t=t(),H(),t),z=U(()=>s("span",null,"战利品：",-1)),E={key:0},G={style:{"margin-right":"5px"}},q=c(" 关闭 "),K={class:"LogContent"},X={class:"logs"},Y={class:"logsItem"},Z={class:"sub"},x={class:"oriHp"},tt={class:"detail"},ot={class:"obj"},st={class:"oriHp"};function nt(t,e,p,i,M,h){const m=b("a-button"),l=b("a-modal");return $(),A(l,{open:p.modalVisible,"onUpdate:open":e[0]||(e[0]=n=>p.modalVisible=n),title:t.$t("battleLog"),width:"1024px"},{footer:d(()=>[a(m,{type:"primary",onClick:i.submit,onCancel:i.submit},{default:d(()=>[q]),_:1},8,["onClick","onCancel"])]),default:d(()=>[s("p",null,"结果："+o(p.fightLog[p.fightLog.length-1].sub)+" 胜",1),z,p.spoils.length===0?($(),k("span",E,"无")):($(!0),k(B,{key:1},R(p.spoils,n=>($(),k("span",G,o(n.name),1))),256)),s("div",K,[($(!0),k(B,null,R(i.fightLogRender,(n,u)=>($(),k("div",X,[s("p",null,o(t.$t("round"))+" "+o(u+1),1),s("div",Y,[s("div",Z,[s("span",null,o(n.sub),1),s("span",x,[s("span",{class:"hp",style:O(`width: ${n.aggressor.hpPercent}px`)},null,4)]),s("span",null,o(n.aggressor.hpPercent)+"%",1),s("span",null," hp: "+o(n.aggressor.hp)+"/"+o(n.aggressor.oriHp),1),s("span",null,o(t.$t("waigong"))+": "+o(n.aggressor.waigong),1),s("span",null,o(t.$t("neigong"))+": "+o(n.aggressor.neigong),1),s("span",null,o(t.$t("waifang"))+": "+o(n.aggressor.waifang),1),s("span",null,o(t.$t("neifang"))+": "+o(n.aggressor.neifang),1),s("span",null,o(t.$t("huixin"))+": "+o(n.aggressor.huixin),1),s("span",null,o(t.$t("huishang"))+": "+o(n.aggressor.huishang),1),s("span",null,o(t.$t("renxing"))+": "+o(n.aggressor.renxing),1)]),s("div",tt,o(n.aggressor.nickname)+" 对 "+o(n.victim.nickname)+" 造成了 "+o(n.damage)+"点 "+o(n.crit?"暴击伤害":"伤害"),1),s("div",ot,[s("span",null,o(n.obj),1),s("span",st,[s("span",{class:"hp",style:O(`width: ${n.victim.hpPercent}px`)},null,4)]),s("span",null,o(n.victim.hpPercent),1),s("span",null," hp: "+o(n.victim.hp)+"/"+o(n.victim.oriHp),1),s("span",null,o(t.$t("waigong"))+": "+o(n.victim.waigong),1),s("span",null,o(t.$t("neigong"))+": "+o(n.victim.neigong),1),s("span",null,o(t.$t("waifang"))+": "+o(n.victim.waifang),1),s("span",null,o(t.$t("neifang"))+": "+o(n.victim.neifang),1),s("span",null,o(t.$t("huixin"))+": "+o(n.victim.huixin),1),s("span",null,o(t.$t("huishang"))+": "+o(n.victim.huishang),1),s("span",null,o(t.$t("renxing"))+": "+o(n.victim.renxing),1)])])]))),256))])]),_:1},8,["open","title"])}const et=N(D,[["render",nt],["__scopeId","data-v-0b156f34"]]),it={fight:{toRolePoint:"1",toMonster:"1",toBoss:"2"}},at={name:"Fight",components:{FightModal:et,QuestionCircleOutlined:S},setup(){const{t}=j(),e=T({uid:sessionStorage.getItem("uid"),missionPoint:"",enemyName:"",enemyId:"",roleOptionsList:[],fightLog:[],spoils:[],currentMonsterWinRate:"0%",currentBossWinRate:"0%",modalVisible:!1});Q(async()=>{await p(),await l(),await n()});const p=async()=>{let r=await P.getRoleList({});e.roleOptionsList=r.data.filter(g=>g.uid!==e.uid).map(g=>({label:g.nickname,value:g.uid})),e.missionPoint=r.data.find(g=>g.uid===e.uid).missionpoint},i=async()=>{let r=await P.getInfo({uid:e.uid});e.missionPoint=r.data.baseInfo.missionpoint},M=async()=>{I.confirm({title:`${t("attackRoleTips")}：${e.enemyName}?`,content:a("div",{style:"color:red;"}),okText:t("attack"),cancelText:t("cancel"),async onOk(){let r=await w.toRole({uid:e.uid,enemyId:String(e.enemyId)});e.fightLog=r.data.fightLog,e.modalVisible=!0,await i()}})},h=async r=>{I.confirm({title:`${t("attackMonsterTips")}：${t("toMonster")}?`,content:a("div",{style:"color:red;"}),async onOk(){let g=await w.toMonster({uid:e.uid,type:r});e.fightLog=g.data.fightLog,e.spoils=g.data.spoils,e.modalVisible=!0,await i()}})},m=async()=>{I.confirm({title:`${t("attackMonsterTips")}：${t("toBoss")}?`,content:a("div",{style:"color:red;"}),async onOk(){let r=await w.toBoss({uid:e.uid});e.fightLog=r.data.fightLog,e.spoils=r.data.spoils,e.modalVisible=!0,await i()}})},l=async()=>{let r=await w.toImitMonster({uid:e.uid}),g=0,C=JSON.parse(sessionStorage.getItem("userInfo")).nickname;for(let v=0;v<r.data.fightLogs.length;v++)r.data.fightLogs[v].sub===C&&g++;e.currentMonsterWinRate=g+"%"},n=async()=>{let r=await w.toImitBoss({uid:e.uid}),g=0,C=JSON.parse(sessionStorage.getItem("userInfo")).nickname;for(let v=0;v<r.data.fightLogs.length;v++)r.data.fightLogs[v].sub===C&&g++;e.currentBossWinRate=g+"%"},u=(r,g)=>{e.enemyName=e.roleOptionsList.find(C=>C.label===g.label).label},f=()=>{},y=()=>{},W=(r,g)=>g.value.toLowerCase().indexOf(r.toLowerCase())>=0,F=()=>{e.modalVisible=!1};return{...L(e),baseConfig:it,filterOption:W,handleChange:u,handleBlur:f,handleFocus:y,QuestionCircleOutlined:S,toRole:M,toMonster:h,toImitMonster:l,toImitBoss:n,toBoss:m,modalClose:F}}},lt={class:"fight"},rt={class:"missionPoint"},dt={class:"class"},gt={class:"row"},ct={class:"classTitle"},ut={class:"toRole"},pt={class:"row"},mt={class:"classTitle"},ft={class:"toMonster"},ht={class:"toMonster"},yt={class:"toMonster"},vt={class:"row"},$t={class:"classTitle"},bt={class:"toBoss"};function kt(t,e,p,i,M,h){const m=b("a-select"),l=b("a-button"),n=b("QuestionCircleOutlined"),u=b("a-tooltip"),f=b("FightModal");return $(),k(B,null,[s("div",lt,[s("p",rt,o(t.$t("missionPoint"))+"："+o(t.missionPoint),1),s("div",dt,[s("div",gt,[s("p",ct,o(t.$t("toRole")),1),s("div",ut,[s("p",null,o(t.$t("useMissionPoint"))+"： "+o(i.baseConfig.fight.toRolePoint),1),a(m,{value:t.enemyId,"onUpdate:value":e[0]||(e[0]=y=>t.enemyId=y),"show-search":"",placeholder:"Select a person",options:t.roleOptionsList,"filter-option":i.filterOption,onFocus:i.handleFocus,onBlur:i.handleBlur,onChange:i.handleChange},null,8,["value","options","filter-option","onFocus","onBlur","onChange"]),a(l,{type:"primary",onClick:i.toRole,disabled:!t.enemyId},{default:d(()=>[c(o(t.$t("attack")),1)]),_:1},8,["onClick","disabled"])])]),s("div",pt,[s("p",mt,o(t.$t("toMonster")),1),s("div",ft,[s("p",null,o(t.$t("gainWeapon")),1),s("p",null,o(t.$t("useMissionPoint"))+"： "+o(i.baseConfig.fight.toMonster),1),a(l,{type:"primary",onClick:e[1]||(e[1]=y=>i.toMonster("2"))},{default:d(()=>[c(o(t.$t("attack")),1)]),_:1}),a(l,{type:"primary",onClick:i.toImitMonster},{default:d(()=>[c(o(t.$t("imitAttack")),1)]),_:1},8,["onClick"]),s("div",null,[c(o(t.$t("currentWinRate"))+" "+o(t.currentMonsterWinRate)+" ",1),a(u,null,{title:d(()=>[c(o(t.$t("monsterTips")),1)]),default:d(()=>[a(n,{style:{color:"#d2d2d2"}})]),_:1})])]),s("div",ht,[s("p",null,o(t.$t("gainArmor")),1),s("p",null,o(t.$t("useMissionPoint"))+"： "+o(i.baseConfig.fight.toMonster),1),a(l,{type:"primary",onClick:e[2]||(e[2]=y=>i.toMonster("3"))},{default:d(()=>[c(o(t.$t("attack")),1)]),_:1}),a(l,{type:"primary",onClick:i.toImitMonster},{default:d(()=>[c(o(t.$t("imitAttack")),1)]),_:1},8,["onClick"]),s("div",null,[c(o(t.$t("currentWinRate"))+" "+o(t.currentMonsterWinRate)+" ",1),a(u,null,{title:d(()=>[c(o(t.$t("monsterTips")),1)]),default:d(()=>[a(n,{style:{color:"#d2d2d2"}})]),_:1})])]),s("div",yt,[s("p",null,o(t.$t("gainOrnament")),1),s("p",null,o(t.$t("useMissionPoint"))+"： "+o(i.baseConfig.fight.toMonster),1),a(l,{type:"primary",onClick:e[3]||(e[3]=y=>i.toMonster("4"))},{default:d(()=>[c(o(t.$t("attack")),1)]),_:1}),a(l,{type:"primary",onClick:i.toImitMonster},{default:d(()=>[c(o(t.$t("imitAttack")),1)]),_:1},8,["onClick"]),s("div",null,[c(o(t.$t("currentWinRate"))+" "+o(t.currentMonsterWinRate)+" ",1),a(u,null,{title:d(()=>[c(o(t.$t("monsterTips")),1)]),default:d(()=>[a(n,{style:{color:"#d2d2d2"}})]),_:1})])])]),s("div",vt,[s("p",$t,o(t.$t("toBoss")),1),s("div",bt,[s("p",null,o(t.$t("useMissionPoint"))+"："+o(i.baseConfig.fight.toBoss),1),a(l,{type:"primary",onClick:i.toBoss},{default:d(()=>[c(o(t.$t("attack")),1)]),_:1},8,["onClick"]),a(l,{type:"primary",onClick:i.toImitBoss},{default:d(()=>[c(o(t.$t("imitAttack")),1)]),_:1},8,["onClick"]),s("div",null,[c(o(t.$t("currentWinRate"))+" "+o(t.currentBossWinRate)+" ",1),a(u,null,{title:d(()=>[c(o(t.$t("bossTips")),1)]),default:d(()=>[a(n,{style:{color:"#d2d2d2"}})]),_:1})])])])])]),a(f,{modalVisible:t.modalVisible,fightLog:t.fightLog,spoils:t.spoils,onSubmit:i.modalClose},null,8,["modalVisible","fightLog","spoils","onSubmit"])],64)}const wt=N(at,[["render",kt],["__scopeId","data-v-15d4b43e"]]);export{wt as default};
//# sourceMappingURL=Fight-CBBfqyTZ.js.map
